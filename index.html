<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>JX Key Generator — Neon</title>

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

<style>
  :root{
    --bg1: #05060a;
    --bg2: #0b1020;
    --glass: rgba(255,255,255,0.04);
    --glass-2: rgba(255,255,255,0.02);
    --neon-cool: #7ef0ff;
    --neon-warm: #ff7ad1;
    --accent: #7c5cff;
    --muted: #9aa4b2;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: radial-gradient(1200px 600px at 10% 10%, rgba(124,92,255,0.10), transparent),
                radial-gradient(1000px 500px at 90% 90%, rgba(126,240,255,0.06), transparent),
                linear-gradient(180deg, var(--bg1), var(--bg2));
    color:#dbe7ff;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:32px;
  }

  .card{
    width:min(820px,96vw);
    max-width:920px;
    border-radius:14px;
    padding:26px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    box-shadow: 0 10px 40px rgba(3,6,20,0.7);
    position:relative;
    overflow:hidden;
    border:1px solid rgba(255,255,255,0.03);
    display:grid;
    gap:18px;
    grid-template-columns: 1fr 360px;
    align-items:start;
  }

  /* decorative neon lines */
  .card::before, .card::after{
    content:"";
    position:absolute;
    inset:0;
    pointer-events:none;
    mix-blend-mode:screen;
  }
  .card::before{
    background: linear-gradient(90deg, transparent, rgba(124,92,255,0.03), transparent);
    transform: translateY(-30%);
    filter: blur(24px);
  }
  .card::after{
    background: radial-gradient(circle at 12% 10%, rgba(126,240,255,0.02), transparent),
                radial-gradient(circle at 88% 90%, rgba(255,122,209,0.02), transparent);
    filter: blur(18px);
  }

  .panel{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:10px;
    padding:20px;
    border: 1px solid rgba(255,255,255,0.03);
    backdrop-filter: blur(8px) saturate(140%);
  }

  header h1{
    margin:0;
    font-size:20px;
    letter-spacing:0.2px;
  }
  header p{margin:8px 0 0;color:var(--muted);font-size:13px}

  /* Left column */
  .left { padding-right:12px; }
  .big-cta{
    margin-top:14px;
    display:flex;
    gap:12px;
    align-items:center;
  }
  button.primary{
    appearance:none;
    border:0;
    background: linear-gradient(90deg,var(--neon-cool),var(--neon-warm));
    color:#04121b;
    font-weight:700;
    padding:12px 18px;
    border-radius:10px;
    cursor:pointer;
    box-shadow: 0 6px 30px rgba(124,92,255,0.12), 0 0 18px rgba(126,240,255,0.06);
    font-size:15px;
    transition:transform .12s ease;
  }
  button.primary:active{ transform:translateY(1px) }
  button.primary[disabled]{ opacity:.55; cursor:not-allowed; transform:none; box-shadow:none; }

  .info-row{display:flex;gap:10px;align-items:center;margin-top:10px}
  .pill{
    font-size:12px;padding:6px 10px;border-radius:999px;background:var(--glass-2);color:var(--muted);
    border:1px solid rgba(255,255,255,0.02)
  }

  /* Right column - result */
  .right { padding-left:12px; display:flex;flex-direction:column; gap:12px }
  .result-box{
    min-height:72px;
    border-radius:10px;
    padding:12px;
    display:flex;
    align-items:center;
    gap:12px;
    background: linear-gradient(180deg, rgba(10,14,22,0.6), rgba(8,10,14,0.4));
    border: 1px solid rgba(126,240,255,0.06);
    box-shadow: inset 0 -6px 30px rgba(0,0,0,0.6);
    overflow-wrap: anywhere;
    position:relative;
  }

  .result-url{ font-family: "JetBrains Mono", monospace; font-size:14px; color:#e9f7ff; }
  .actions{ display:flex; gap:8px; margin-left:auto; align-items:center }

  .icon-btn{
    background:transparent;border:1px solid rgba(255,255,255,0.03);padding:8px;border-radius:8px;cursor:pointer;color:var(--muted);
    display:inline-flex;align-items:center;gap:8px;
  }
  .icon-btn:hover{ color:var(--neon-cool); border-color:rgba(126,240,255,0.10) }

  .small{ font-size:12px;color:var(--muted) }

  .status {
    margin-top:6px;
  }

  /* spinner */
  .spinner{
    width:18px;height:18px;border-radius:50%;border:2px solid rgba(255,255,255,0.06);border-top-color:var(--neon-cool);
    animation:spin 1s linear infinite;
  }
  @keyframes spin{ to{transform:rotate(360deg)} }

  footer{ grid-column:1/-1; color:var(--muted);display:flex;justify-content:space-between;align-items:center;font-size:13px;padding-top:6px }
  .credit{ display:flex; gap:10px; align-items:center; color:var(--muted) }

  @media (max-width:880px){
    .card{ grid-template-columns: 1fr; }
    .right{ order:-1 }
  }
</style>
</head>
<body>
  <main class="card" role="main" aria-live="polite">
    <section class="left panel">
      <header>
        <h1>JX Key Generator</h1>
        <p>Generates a Junkie-Development flow link via the JX generator API — proxied through this Vercel function.</p>
      </header>

      <div class="big-cta">
        <button id="generateBtn" class="primary" aria-label="Generate key">Generate key</button>

        <div style="display:flex;flex-direction:column;justify-content:center;">
          <div class="pill small" id="cooldownPill">Ready</div>
        </div>
      </div>

      <div class="info-row">
        <div class="small">API: <code style="color:var(--muted);font-family:inherit">/api/generate</code></div>
        <div style="flex:1"></div>
        <div class="small">Design: <span style="color:var(--neon-warm)">Cyberpunk</span> · Glass</div>
      </div>

      <div style="height:14px"></div>

      <div class="small status" id="statusText">Click <strong>Generate</strong> to create a new key.</div>
    </section>

    <aside class="right panel">
      <div class="small" style="color:var(--muted)">Generated result</div>

      <div class="result-box" id="resultBox" aria-live="polite">
        <div class="result-url" id="resultText">No result yet — click Generate.</div>
        <div class="actions" role="group" aria-label="Actions">
          <button class="icon-btn" id="copyBtn" title="Copy" aria-label="Copy result" disabled>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M9 9H5a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <span class="small">Copy</span>
          </button>

          <button class="icon-btn" id="openBtn" title="Open" aria-label="Open result" disabled>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M14 3h7v7" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M10 14L21 3" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 21H3V3" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <span class="small">Open</span>
          </button>
        </div>
      </div>

      <div class="small" style="color:var(--muted);margin-top:6px">Source proxied by <code>/api/generate</code> (ensures Vercel handles CORS).</div>
    </aside>

    <footer>
      <div class="credit">Made with <span style="color:var(--neon-cool)">♥</span> · <span style="color:var(--accent)">Neon</span> UI</div>
      <div class="small">Tip: click Copy then Open in new tab</div>
    </footer>
  </main>

<script>
  const generateBtn = document.getElementById('generateBtn');
  const resultText = document.getElementById('resultText');
  const statusText = document.getElementById('statusText');
  const cooldownPill = document.getElementById('cooldownPill');
  const copyBtn = document.getElementById('copyBtn');
  const openBtn = document.getElementById('openBtn');

  let cooldown = false;
  const COOLDOWN_MS = 2500; // short cooldown to avoid rapid calls

  async function setCooldown(ms){
    cooldown = true;
    cooldownPill.textContent = 'Cooldown';
    let left = ms;
    const step = 250;
    const iv = setInterval(()=>{
      left -= step;
      cooldownPill.textContent = 'Cooldown — ' + Math.max(0, Math.ceil(left/1000)) + 's';
    }, step);
    await new Promise(r => setTimeout(r, ms));
    clearInterval(iv);
    cooldown = false;
    cooldownPill.textContent = 'Ready';
  }

  async function fetchResult(){
    setUIWhileLoading(true);
    statusText.textContent = 'Requesting new key…';
    try {
      const r = await fetch('/api/generate', { cache: 'no-store' });
      if (!r.ok) throw new Error('Server ' + r.status);
      const data = await r.json();
      if (data && data.status === 'success' && data.result){
        resultText.textContent = data.result;
        statusText.textContent = 'Success — generated.';
        enableActions(true);
      } else if (data && data.result) {
        // still show result if returned but status changed
        resultText.textContent = data.result;
        statusText.textContent = 'Received result (status ≠ success).';
        enableActions(true);
      } else {
        throw new Error('Invalid response shape');
      }
    } catch (err){
      console.error(err);
      resultText.textContent = 'Error: ' + (err.message || 'Request failed');
      statusText.textContent = 'Failed to generate — see result box.';
      enableActions(false);
    } finally {
      setUIWhileLoading(false);
    }
  }

  function setUIWhileLoading(isLoading){
    generateBtn.disabled = isLoading || cooldown;
    if (isLoading){
      generateBtn.innerHTML = '<span class="spinner" aria-hidden></span> Generating…';
    } else {
      generateBtn.innerHTML = 'Generate key';
      if (!cooldown){
        generateBtn.disabled = false;
      }
    }
  }

  function enableActions(enabled){
    copyBtn.disabled = !enabled;
    openBtn.disabled = !enabled;
  }

  generateBtn.addEventListener('click', async ()=>{
    if (cooldown) return;
    await fetchResult();
    setCooldown(COOLDOWN_MS);
    setTimeout(()=>{ /* re-enable button after cooldown */ generateBtn.disabled = false; }, COOLDOWN_MS);
  });

  copyBtn.addEventListener('click', async ()=>{
    const text = resultText.textContent;
    if (!text || text.startsWith('Error:')) return;
    try {
      await navigator.clipboard.writeText(text);
      statusText.textContent = 'Copied to clipboard';
    } catch (e) {
      statusText.textContent = 'Copy failed';
    }
  });

  openBtn.addEventListener('click', ()=>{
    const url = resultText.textContent;
    if (!url || url.startsWith('Error:')) return;
    window.open(url, '_blank', 'noopener');
  });
</script>
</body>
</html>
